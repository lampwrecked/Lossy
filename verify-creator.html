<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Verify Lossy Collection Creator</title>
<style>
  * { box-sizing: border-box; margin: 0; padding: 0; }
  body {
    background: #050506;
    color: #ff8020;
    font-family: 'Courier New', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 24px;
  }
  h1 {
    font-size: 18px;
    letter-spacing: 0.15em;
    margin-bottom: 8px;
    text-transform: uppercase;
  }
  .sub {
    font-size: 11px;
    color: rgba(255,128,32,0.5);
    letter-spacing: 0.1em;
    margin-bottom: 40px;
    text-align: center;
  }
  .card {
    background: rgba(255,128,32,0.04);
    border: 1px solid rgba(255,128,32,0.2);
    padding: 24px;
    max-width: 480px;
    width: 100%;
    margin-bottom: 16px;
  }
  .label {
    font-size: 9px;
    color: rgba(255,128,32,0.4);
    letter-spacing: 0.15em;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .value {
    font-size: 11px;
    color: rgba(255,128,32,0.8);
    word-break: break-all;
    line-height: 1.5;
    margin-bottom: 16px;
  }
  button {
    width: 100%;
    background: none;
    border: 1px solid rgba(255,128,32,0.5);
    color: #ff8020;
    font-family: 'Courier New', monospace;
    font-size: 12px;
    letter-spacing: 0.15em;
    text-transform: uppercase;
    padding: 14px;
    cursor: pointer;
    transition: all 0.2s;
    margin-bottom: 12px;
  }
  button:hover { background: rgba(255,128,32,0.1); border-color: #ff8020; }
  button:disabled { opacity: 0.3; cursor: default; }
  #status {
    font-size: 11px;
    color: rgba(255,128,32,0.7);
    text-align: center;
    line-height: 1.6;
    min-height: 40px;
    margin-top: 8px;
  }
  #status.success { color: #40ff80; }
  #status.error   { color: #ff4040; }
  .wallet-info {
    font-size: 10px;
    color: rgba(255,128,32,0.4);
    text-align: center;
    margin-top: 8px;
    word-break: break-all;
  }
  a { color: rgba(255,128,32,0.6); text-decoration: none; }
  a:hover { color: #ff8020; }
</style>
</head>
<body>

<h1>Lossy</h1>
<div class="sub">Collection Creator Verification</div>

<div class="card">
  <div class="label">Collection Mint</div>
  <div class="value">4Lk9fe23hLkSAu5MBLhDPZqM2vRx3vQ2C2nAYzhu1TXp</div>

  <div class="label">Creator to Verify</div>
  <div class="value">FrstHD18pJsFRatk2hnfv4EztP1p87mJ1SL6QyXCcQju</div>

  <div class="label">Network</div>
  <div class="value">Solana Mainnet</div>
</div>

<div class="card">
  <button id="connect-btn" onclick="connectWallet()">Connect Phantom</button>
  <button id="verify-btn" onclick="verifyCreator()" disabled>Sign & Verify Creator</button>
  <div id="status">Connect your Phantom wallet (FrstHD18...) to begin.</div>
  <div class="wallet-info" id="wallet-info"></div>
</div>

<script type="module">
  import { Connection, PublicKey, Transaction } from 'https://esm.sh/@solana/web3.js@1.91.1';
  import { createSignMetadataInstruction, findMetadataPda } from 'https://esm.sh/@metaplex-foundation/mpl-token-metadata@3.2.1';

  const COLLECTION_MINT = new PublicKey('4Lk9fe23hLkSAu5MBLhDPZqM2vRx3vQ2C2nAYzhu1TXp');
  const CREATOR_ADDRESS = new PublicKey('FrstHD18pJsFRatk2hnfv4EztP1p87mJ1SL6QyXCcQju');
  const RPC = 'https://api.mainnet-beta.solana.com';

  let walletPublicKey = null;

  window.connectWallet = async function() {
    const status = document.getElementById('status');
    const info   = document.getElementById('wallet-info');

    try {
      const phantom = window.solana;
      if (!phantom || !phantom.isPhantom) {
        status.className = 'error';
        status.textContent = 'Phantom not found. Open this page inside the Phantom browser.';
        return;
      }

      status.textContent = 'Connecting...';
      const resp = await phantom.connect();
      walletPublicKey = resp.publicKey;

      const addr = walletPublicKey.toBase58();
      info.textContent = 'Connected: ' + addr;

      if (addr !== CREATOR_ADDRESS.toBase58()) {
        status.className = 'error';
        status.textContent = 'Wrong wallet. Connect FrstHD18pJsFRatk2hnfv4EztP1p87mJ1SL6QyXCcQju — the creator wallet.';
        document.getElementById('verify-btn').disabled = true;
        return;
      }

      status.className = '';
      status.textContent = 'Wallet connected. Ready to verify.';
      document.getElementById('connect-btn').disabled = true;
      document.getElementById('verify-btn').disabled = false;

    } catch (err) {
      status.className = 'error';
      status.textContent = 'Connection failed: ' + err.message;
    }
  };

  window.verifyCreator = async function() {
    const status  = document.getElementById('status');
    const btn     = document.getElementById('verify-btn');
    btn.disabled  = true;
    status.className = '';
    status.textContent = 'Building transaction...';

    try {
      const connection = new Connection(RPC, 'confirmed');
      const phantom    = window.solana;

      // Derive metadata PDA for the collection mint
      const TOKEN_METADATA_PROGRAM = new PublicKey('metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s');
      const [metadataPda] = PublicKey.findProgramAddressSync(
        [
          Buffer.from('metadata'),
          TOKEN_METADATA_PROGRAM.toBuffer(),
          COLLECTION_MINT.toBuffer(),
        ],
        TOKEN_METADATA_PROGRAM
      );

      // Build signMetadata instruction
      const signIx = createSignMetadataInstruction({
        metadata: metadataPda,
        creator:  CREATOR_ADDRESS,
      });

      const { blockhash } = await connection.getLatestBlockhash();
      const tx = new Transaction();
      tx.recentBlockhash = blockhash;
      tx.feePayer        = CREATOR_ADDRESS;
      tx.add(signIx);

      status.textContent = 'Approve the transaction in Phantom...';

      const signed = await phantom.signAndSendTransaction(tx);

      status.className = 'success';
      status.textContent = '✓ Creator verified! Tx: ' + signed.signature.slice(0, 20) + '...\n\nYou can now delete this page from your repo.';

    } catch (err) {
      status.className = 'error';
      status.textContent = 'Error: ' + err.message;
      btn.disabled = false;
    }
  };

  // Auto-detect if already connected
  window.addEventListener('load', async () => {
    if (window.solana?.isConnected) {
      await window.connectWallet();
    }
  });
</script>

</body>
</html>
